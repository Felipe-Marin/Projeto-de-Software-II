<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="theme-color" content="#33691e">
    <title>Coleta Seletiva Solidária UFSM</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="styles/materialize.css">
    <link rel="stylesheet" type="text/css" href="styles/search.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" charset="utf8" src="scripts/jquery-1.12.4.js"></script>
    <script type="text/javascript" charset="utf8" src="scripts/materialize.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script type="text/javascript" charset="utf8" src="scripts/admin.js"></script>
    <link rel="manifest" href="/manifest.json">
    <meta name="google-signin-scope" content="profile email spreadsheets">
    <meta name="google-signin-client_id" content="APIKEY.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script>
        function onSignIn(googleUser) {
            // Useful data for your client-side scripts:
            var profile = googleUser.getBasicProfile();
            console.log("ID: " + profile.getId()); // Don't send this directly to your server!
            console.log('Full Name: ' + profile.getName());
            console.log('Given Name: ' + profile.getGivenName());
            console.log('Family Name: ' + profile.getFamilyName());
            console.log("Image URL: " + profile.getImageUrl());
            console.log("Email: " + profile.getEmail());

            // The ID token you need to pass to your backend:
            var id_token = googleUser.getAuthResponse().id_token;
            token = id_token;
            console.log("ID Token: " + id_token);
            $('#signoutLink').html(profile.getName() + "<a class=\"waves-effect waves-light btn\" onclick=\"signOut();\">Sair</a>");
            $('#signoutLink').show();
            getSheet();
        };
    </script>
    <script>
        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log('User signed out.');
                $('#signoutLink').html("");
                $('#signoutLink').hide();
            });
        }
    </script>
    <!--script>
            var map;
            function initMap() {
                var center = { lat: -29.714315714425528, lng: -53.71471834680483 };
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 15,
                    center: center
                });
                var content = '<div>' + 
                    '<h6>Adicionar Contêiner</h6>' +
                    '<div class="input-field">' +
                    '<input id="inputNome" type="text">' +
                    '<label for="inputNome">Nome</label>' +
                    '</div>' +
                    '<img id="buttonLixeiraVerde" src="images/lixeiraverde.png" class="z-depth-1" style="width:30px;heigth:30px;margin-left:2px;"></img>' +
                    '<img id="buttonTonelAzul" src="images/tonelazul.png" class="z-depth-1" style="width:30px;heigth:30px;margin-left:2px;"></img>' +
                    '</div>';
                var infowindow = false;
                map.addListener('click', function(e){
                    if(infowindow){
                        infowindow.close();
                    }
                    infowindow = new google.maps.InfoWindow({content:content});
                    infowindow.setPosition(e.latLng);
                    infowindow.open(map);
                    $('#buttonLixeiraVerde').click(function(){
                        var icon = 'images/mapicon_reciclavel.png';
                        var marker = new google.maps.Marker({
                            position: e.latLng,
                            map: map,
                            title: $('#inputNome').val(),
                            icon: icon
                        });
                    });
                });
                $

            }
            function getSheet() {
                var data = {};
                $.ajax({
                    url: 'https://sheets.googleapis.com/v4/spreadsheets/1CNFUNPva91WPsoD2Yr0n3KQ4BjZcNkBRFhsYub1ClpA/values/Coletores!A2:D1000?key=APIKEY',
                    data: data,
                    dataType: 'json',
                    success: function (data) {
                        console.log(data.values);
                        $.each(data.values, function (index, row) {
                            var icon;
                            if (row[3] == 'reciclavel') {
                                icon = 'images/mapicon_reciclavel.png'
                            }
                            else {
                                icon = 'images/mapicon_eletronico.png'
                            }
                            var marker = new google.maps.Marker({
                                position: { lat: parseFloat(row[1]), lng: parseFloat(row[2]) },
                                map: map,
                                title: row[0],
                                icon: icon
                            });
                        });
                    }
                });
            }
    </script-->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6QEqPesjp59dV_Iqa0T56y_NcnTMSbjw&callback=initMap"></script>
    <script>

    </script>
</head>

<body>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper light-green darken-4">
                <a href="#" class="brand-logo hide-on-med-and-down">Coleta Seletiva UFSM</a>
                <a href="#" class="hide-on-large-only center-align" style="font-size:25px">Coleta Seletiva UFSM</a>
                <ul class="right hide-on-med-and-down">
                    <li id="signoutLink" style="display:none;"></li>
                </ul>
            </div>
        </nav>
    </div>
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l6">
                <h4>Planilha</h4>
                <p>Escolha uma planilha para salvar os locais de coleta.</p>
                <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
                <div id="planilhas">

                </div>
            </div>
            <div class="col s12 m12 l6">
                <h4>Locais de Coleta</h4>
                <div id="map" style="width:100%; height:400px;"></div>
            </div>
        </div>
    </div>
</body>

</html>